---
import Layout from "../layouts/Layout.astro";
import Input from "../components/Input.astro";
import Checkbox from "../components/Checkbox.astro";
import Button from "../components/Button.astro";
import Divider from "../components/Divider.astro";
---

<Layout title="RSVP">
  <p>Please RSVP for your entire group.</p>

  <form class="flex flex-col gap-16 items-center" method="post" id="rsvp-form">
    <div class="flex flex-col gap-4">
      <Input id="guest_name" name="guest_name" label="Your name" />
      <Input id="guest_plus_one_name" name="guest_plus_one_name" label="Your plus one's name" />
      <Checkbox class="pt-2" id="attending" name="attending" label="Will you be attending?" />
      <Divider />
      <Input id="dietary-restrictions" name="dietary-restrictions" label="Do you have any dietary requirements?" />
      <Input id="children" name="children" label="Are you bringing any children?" />
      <Input id="song_choice" name="song_choice" label="What song will get you on the dance floor?" />
      <Divider />
      <Input id="email" name="email" label="Your email" />
    </div>
    <Button type="submit" text="Submit RSVP" />
  </form>
</Layout>

<script>
  async function handleSubmit(event: any) {
    event.preventDefault();

    const formData = new FormData(event.target);
    const response = await fetch("https://submitrsvp-aepvkdfurq-uc.a.run.app", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        name: formData.get("name"),
        email: formData.get("email"),
        attending: formData.get("attending") === "yes"
      })
    });

    if (response.ok) {
      alert("RSVP submitted successfully!");
    } else {
      alert("Error submitting RSVP.");
    }
  }

  document.getElementById("rsvp-form")?.addEventListener("submit", handleSubmit);
</script>